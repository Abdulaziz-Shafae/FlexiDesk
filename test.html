<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gantt Chart</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.5.0/frappe-gantt.css">
    <style>
        .low { background: #28a745; color: white; }
        .medium-low { background: #17a2b8; color: white; }
        .medium { background: #ffc107; color: black; }
        .high { background: #fd7e14; color: white; }
        .critical { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <h2>Gantt Chart</h2>
    <svg id="gantt"></svg>
    <button onclick="openModal()">Add Task</button>
    
    <div id="taskModal" style="display:none; position: fixed; top: 10%; left: 30%; background: white; padding: 20px; border: 1px solid black;">
        <h3>Add New Task</h3>
        <input type="text" id="taskName" placeholder="Task Name">
        <input type="date" id="taskStart" placeholder="Start Date">
        <input type="number" id="taskDuration" placeholder="Duration (days)">
        <input type="number" id="taskPercentage" placeholder="Completion %">
        <select id="taskPriority">
            <option value="low">Low</option>
            <option value="medium-low">Medium-Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
            <option value="critical">Critical</option>
        </select>
        <select id="taskDependencies">
            <option value="none">No Dependencies</option>
        </select>
        <textarea id="taskComments" placeholder="Comments"></textarea>
        <button onclick="addTask()">Add</button>
        <button onclick="closeModal()">Close</button>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/frappe-gantt/0.5.0/frappe-gantt.min.js"></script>
    <script>
        let tasks = [
            { id: "1", name: "Task 1", start: "2024-02-10", end: "2024-02-15", progress: 50, dependencies: "", priority: "medium" },
            { id: "2", name: "Task 2", start: "2024-02-12", end: "2024-02-18", progress: 30, dependencies: "1", priority: "high" },
            { id: "3", name: "Task 3", start: "2024-02-14", end: "2024-02-20", progress: 80, dependencies: "2", priority: "critical" }
        ];

        function renderGantt() {
            document.getElementById("gantt").innerHTML = "";
            new Gantt("#gantt", tasks, {
                on_click: task => alert("Task: " + task.name),
                on_date_change: (task, start, end) => {
                    task.start = start;
                    task.end = end;
                },
                on_progress_change: (task, progress) => task.progress = progress,
                on_view_change: mode => console.log("View mode changed to", mode)
            });
        }

        function openModal() {
            document.getElementById("taskModal").style.display = "block";
            let dependenciesSelect = document.getElementById("taskDependencies");
            dependenciesSelect.innerHTML = '<option value="none">No Dependencies</option>';
            tasks.forEach(task => {
                let option = document.createElement("option");
                option.value = task.id;
                option.textContent = task.name;
                dependenciesSelect.appendChild(option);
            });
        }

        function closeModal() {
            document.getElementById("taskModal").style.display = "none";
        }

        function addTask() {
            let name = document.getElementById("taskName").value;
            let start = document.getElementById("taskStart").value;
            let duration = parseInt(document.getElementById("taskDuration").value);
            let percentage = parseInt(document.getElementById("taskPercentage").value);
            let priority = document.getElementById("taskPriority").value;
            let dependencies = document.getElementById("taskDependencies").value;
            let comments = document.getElementById("taskComments").value;
            
            let end = new Date(start);
            end.setDate(end.getDate() + duration);
            end = end.toISOString().split('T')[0];

            tasks.push({
                id: (tasks.length + 1).toString(),
                name, start, end, progress: percentage,
                dependencies: dependencies === "none" ? "" : dependencies,
                priority, comments
            });
            
            closeModal();
            renderGantt();
        }

        renderGantt();
    </script>
</body>
</html>
